{"version":3,"file":"gradebooksetup_forms.min.js","sources":["../src/gradebooksetup_forms.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Prints the add item gradebook form\n *\n * @module core_grades\n * @copyright 2023 Mathew May <mathew.solutions>\n * @license http://www.gnu.org/copyleft/gpl.html GNU Public License\n */\n\nimport ModalForm from 'core_form/modalform';\nimport {getString} from 'core/str';\nimport Notification from 'core/notification';\nimport * as FormChangeChecker from 'core_form/changechecker';\n\nconst Selectors = {\n    advancedFormLink: 'a.showadvancedform'\n};\n\n/**\n * Initialize module\n */\nexport const init = () => {\n    // Sometimes the trigger does not exist, so lets conditionally add it.\n    document.addEventListener('click', event => {\n        const args = {};\n\n        let formClass = null;\n        let title = null;\n        let trigger = null;\n        if (event.target.closest('[data-trigger=\"add-item-form\"]')) {\n            event.preventDefault();\n            trigger = event.target.closest('[data-trigger=\"add-item-form\"]');\n            formClass = 'core_grades\\\\form\\\\add_item';\n            title = trigger.getAttribute('data-itemid') === '-1' ?\n                getString('newitem', 'core_grades') : getString('itemsedit', 'core_grades');\n            args.itemid = trigger.getAttribute('data-itemid');\n        } else if (event.target.closest('[data-trigger=\"add-category-form\"]')) {\n            event.preventDefault();\n            trigger = event.target.closest('[data-trigger=\"add-category-form\"]');\n            formClass = 'core_grades\\\\form\\\\add_category';\n            title = trigger.getAttribute('data-category') === '-1' ?\n                getString('newcategory', 'core_grades') : getString('categoryedit', 'core_grades');\n            args.category = trigger.getAttribute('data-category');\n        } else if (event.target.closest('[data-trigger=\"add-outcome-form\"]')) {\n            event.preventDefault();\n            trigger = event.target.closest('[data-trigger=\"add-outcome-form\"]');\n            formClass = 'core_grades\\\\form\\\\add_outcome';\n            title = trigger.getAttribute('data-itemid') === '-1' ?\n                getString('newoutcomeitem', 'core_grades') : getString('outcomeitemsedit', 'core_grades');\n            args.itemid = trigger.getAttribute('data-itemid');\n        }\n\n        if (trigger) {\n            args.courseid = trigger.getAttribute('data-courseid');\n            args.gpr_plugin = trigger.getAttribute('data-gprplugin');\n\n            const modalForm = new ModalForm({\n                modalConfig: {\n                    title: title,\n                },\n                formClass: formClass,\n                args: args,\n                saveButtonText: getString('save', 'core'),\n                returnFocus: trigger,\n            });\n\n            // Show a toast notification when the form is submitted.\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, event => {\n                if (event.detail.result) {\n                    window.location.assign(event.detail.url);\n                } else {\n                    Notification.addNotification({\n                        type: 'error',\n                        message: getString('saving_failed', 'core_grades')\n                    });\n                }\n            });\n\n            modalForm.show();\n        }\n\n        const showAdvancedForm = event.target.closest(Selectors.advancedFormLink);\n        if (showAdvancedForm) { // Navigate to the advanced form page and cary over any entered data.\n            event.preventDefault();\n            const form = event.target.closest('form');\n            form.action = showAdvancedForm.href;\n            // Disable the form change checker as we are going to carry over the data to the advanced form.\n            FormChangeChecker.disableAllChecks();\n            form.submit();\n        }\n    });\n};\n"],"names":["_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireDefault","obj","__esModule","default","_modalform","_notification","FormChangeChecker","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","_interopRequireWildcard","Selectors","_exports","init","document","addEventListener","event","args","formClass","title","trigger","target","closest","preventDefault","getAttribute","getString","itemid","category","courseid","gpr_plugin","modalForm","ModalForm","modalConfig","saveButtonText","returnFocus","events","FORM_SUBMITTED","detail","result","window","location","assign","url","Notification","addNotification","type","message","show","showAdvancedForm","form","action","href","disableAllChecks","submit"],"mappings":"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"}