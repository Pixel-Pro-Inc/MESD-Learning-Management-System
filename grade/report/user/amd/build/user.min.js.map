{"version":3,"file":"user.min.js","sources":["../src/user.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Allow the user to search for learners within the user report.\n *\n * @module    gradereport_user/user\n * @copyright 2023 Mathew May <mathew.solutions>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport UserSearch from 'core_user/comboboxsearch/user';\nimport Url from 'core/url';\nimport {renderForPromise, replaceNodeContents} from 'core/templates';\nimport * as Repository from 'core_grades/searchwidget/repository';\n\nexport default class User extends UserSearch {\n\n    constructor() {\n        super();\n    }\n\n    static init() {\n        return new User();\n    }\n\n    /**\n     * Build the content then replace the node.\n     */\n    async renderDropdown() {\n        const {html, js} = await renderForPromise('core_user/comboboxsearch/resultset', {\n            users: this.getMatchedResults().slice(0, 5),\n            hasresults: this.getMatchedResults().length > 0,\n            matches: this.getDatasetSize(),\n            searchterm: this.getSearchTerm(),\n            selectall: this.selectAllResultsLink(),\n        });\n        replaceNodeContents(this.getHTMLElements().searchDropdown, html, js);\n    }\n\n    /**\n     * Build up the view all link.\n     *\n     * @returns {string|*}\n     */\n    selectAllResultsLink() {\n        return Url.relativeUrl('/grade/report/user/index.php', {\n            id: this.courseID,\n            userid: 0,\n            searchvalue: this.getSearchTerm()\n        }, false);\n    }\n\n    /**\n     * Build up the view all link that is dedicated to a particular result.\n     *\n     * @param {Number} userID The ID of the user selected.\n     * @returns {string|*}\n     */\n    selectOneLink(userID) {\n        return Url.relativeUrl('/grade/report/user/index.php', {\n            id: this.courseID,\n            searchvalue: this.getSearchTerm(),\n            userid: userID,\n        }, false);\n    }\n\n    /**\n     * Get the data we will be searching against in this component.\n     *\n     * @returns {Promise<*>}\n     */\n    fetchDataset() {\n        // Small typing checks as sometimes groups don't exist therefore the element returns a empty string.\n        const gts = typeof (this.groupID) === \"string\" && this.groupID === '' ? 0 : this.groupID;\n        return Repository.userFetch(this.courseID, gts).then((r) => r.users);\n    }\n}\n"],"names":["_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireDefault","obj","__esModule","default","_user","_url","Repository","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","_interopRequireWildcard","User","UserSearch","constructor","super","init","renderDropdown","html","js","renderForPromise","users","this","getMatchedResults","slice","hasresults","length","matches","getDatasetSize","searchterm","getSearchTerm","selectall","selectAllResultsLink","replaceNodeContents","getHTMLElements","searchDropdown","Url","relativeUrl","id","courseID","userid","searchvalue","selectOneLink","userID","fetchDataset","gts","groupID","userFetch","then","_exports"],"mappings":"kMAyBkE,SAAAA,yBAAAC,GAAA,GAAA,mBAAAC,QAAA,OAAA,KAAA,IAAAC,EAAAD,IAAAA,QAAAE,EAAAF,IAAAA,eAAAF,yBAAA,SAAAC,GAAAA,OAAAA,EAAAG,EAAAD,IAAAF,EAAA,CAAA,SAAAI,uBAAAC,KAAAA,OAAAA,KAAAA,IAAAC,WAAAD,IAAAE,CAAAA,QAAAF,IAAA;;;;;;;qFAHlEG,MAAAJ,uBAAAI,OACAC,KAAAL,uBAAAK,MAEAC,WAAkE,SAAAV,EAAAE,GAAAA,IAAAA,GAAAF,GAAAA,EAAAM,kBAAAN,EAAA,GAAA,OAAAA,GAAA,iBAAAA,GAAA,mBAAAA,EAAA,MAAA,CAAAO,QAAAP,GAAA,IAAAG,EAAAJ,yBAAAG,GAAAC,GAAAA,GAAAA,EAAAQ,IAAAX,GAAAG,OAAAA,EAAAS,IAAAZ,GAAAa,IAAAA,GAAAC,UAAA,MAAAC,EAAAC,OAAAC,gBAAAD,OAAAE,yBAAA,IAAA,IAAAC,KAAAnB,EAAA,GAAA,YAAAmB,GAAAH,OAAAI,UAAAC,eAAAC,KAAAtB,EAAAmB,GAAAI,CAAAA,IAAAA,EAAAR,EAAAC,OAAAE,yBAAAlB,EAAAmB,GAAA,KAAAI,IAAAA,EAAAX,KAAAW,EAAAC,KAAAR,OAAAC,eAAAJ,EAAAM,EAAAI,GAAAV,EAAAM,GAAAnB,EAAAmB,EAAA,CAAA,OAAAN,EAAAN,QAAAP,EAAAG,GAAAA,EAAAqB,IAAAxB,EAAAa,GAAAA,CAAA,CAAlEY,CAAAf,YAEe,MAAMgB,aAAaC,MAAAA,QAE9BC,WAAAA,GACIC,OACJ,CAEA,WAAOC,GACH,OAAO,IAAIJ,IACf,CAKA,oBAAMK,GACF,MAAMC,KAACA,KAAIC,GAAEA,UAAY,EAAAC,WAAgBA,kBAAC,qCAAsC,CAC5EC,MAAOC,KAAKC,oBAAoBC,MAAM,EAAG,GACzCC,WAAYH,KAAKC,oBAAoBG,OAAS,EAC9CC,QAASL,KAAKM,iBACdC,WAAYP,KAAKQ,gBACjBC,UAAWT,KAAKU,0BAEpB,EAAAC,WAAmBA,qBAACX,KAAKY,kBAAkBC,eAAgBjB,KAAMC,GACrE,CAOAa,oBAAAA,GACI,OAAOI,KAAG3C,QAAC4C,YAAY,+BAAgC,CACnDC,GAAIhB,KAAKiB,SACTC,OAAQ,EACRC,YAAanB,KAAKQ,kBACnB,EACP,CAQAY,aAAAA,CAAcC,QACV,OAAOP,KAAG3C,QAAC4C,YAAY,+BAAgC,CACnDC,GAAIhB,KAAKiB,SACTE,YAAanB,KAAKQ,gBAClBU,OAAQG,SACT,EACP,CAOAC,YAAAA,GAEI,MAAMC,IAAgC,iBAAlBvB,KAAKwB,SAA0C,KAAjBxB,KAAKwB,QAAiB,EAAIxB,KAAKwB,QACjF,OAAOlD,WAAWmD,UAAUzB,KAAKiB,SAAUM,KAAKG,MAAM5D,GAAMA,EAAEiC,OAClE,EACH,OAAA4B,SAAAxD,QAAAmB,KAAAqC,SAAAxD,OAAA"}