{"version":3,"file":"search_combobox.min.js","sources":["../../src/comboboxsearch/search_combobox.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport $ from 'jquery';\nimport CustomEvents from \"core/custom_interaction_events\";\nimport {debounce} from 'core/utils';\nimport Pending from 'core/pending';\n\n/**\n * The class that manages the state of the search within a combobox.\n *\n * @module    core/comboboxsearch/search_combobox\n * @copyright 2023 Mathew May <mathew.solutions>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// Reused variables for the class.\nconst events = [\n    'keydown',\n    CustomEvents.events.activate,\n    CustomEvents.events.keyboardActivate\n];\nconst UP = -1;\nconst DOWN = 1;\n\nexport default class {\n    // Define our standard lookups.\n    selectors = {\n        component: this.componentSelector(),\n        trigger: this.triggerSelector(),\n        input: '[data-action=\"search\"]',\n        clearSearch: '[data-action=\"clearsearch\"]',\n        dropdown: this.dropdownSelector(),\n        resultitems: '[role=\"option\"]',\n        viewall: '#select-all',\n    };\n\n    // The results from the called filter function.\n    matchedResults = [];\n\n    // What did the user search for?\n    searchTerm = '';\n\n    // What the user searched for as a lowercase.\n    preppedSearchTerm = null;\n\n    // The DOM nodes after the dropdown render.\n    resultNodes = [];\n\n    // Where does the user currently have focus?\n    currentNode = null;\n\n    // The current node for the view all link.\n    currentViewAll = null;\n\n    dataset = null;\n\n    datasetSize = 0;\n\n    // DOM nodes that persist.\n    component = document.querySelector(this.selectors.component);\n    searchInput = this.component.querySelector(this.selectors.input);\n    searchDropdown = this.component.querySelector(this.selectors.dropdown);\n    clearSearchButton = this.component.querySelector(this.selectors.clearSearch);\n    $component = $(this.component);\n\n    constructor() {\n        // If we have a search input, try to get the value otherwise fallback.\n        this.setSearchTerms(this.searchInput?.value ?? '');\n        // Begin handling the base search component.\n        this.registerClickHandlers();\n        this.registerKeyHandlers();\n        // Conditionally set up the input handler since we don't know exactly how we were called.\n        if (this.searchInput !== null) {\n            this.registerInputHandlers();\n        }\n    }\n\n    /**\n     * Stub out a required function.\n     */\n    fetchDataset() {\n        throw new Error(`fetchDataset() must be implemented in ${this.constructor.name}`);\n    }\n\n    /**\n     * Stub out a required function.\n     * @param {Array} dataset\n     */\n    filterDataset(dataset) {\n        throw new Error(`filterDataset(${dataset}) must be implemented in ${this.constructor.name}`);\n    }\n\n    /**\n     * Stub out a required function.\n     */\n    filterMatchDataset() {\n        throw new Error(`filterMatchDataset() must be implemented in ${this.constructor.name}`);\n    }\n\n    /**\n     * Stub out a required function.\n     */\n    renderDropdown() {\n        throw new Error(`renderDropdown() must be implemented in ${this.constructor.name}`);\n    }\n\n    /**\n     * Stub out a required function.\n     */\n    componentSelector() {\n        throw new Error(`componentSelector() must be implemented in ${this.constructor.name}`);\n    }\n\n    /**\n     * Stub out a required function.\n     */\n    dropdownSelector() {\n        throw new Error(`dropdownSelector() must be implemented in ${this.constructor.name}`);\n    }\n\n    /**\n     * Stub out a required function.\n     */\n    triggerSelector() {\n        throw new Error(`triggerSelector() must be implemented in ${this.constructor.name}`);\n    }\n\n    /**\n     * Return the dataset that we will be searching upon.\n     *\n     * @returns {Promise<null>}\n     */\n    async getDataset() {\n        if (!this.dataset) {\n            this.dataset = await this.fetchDataset();\n        }\n        this.datasetSize = this.dataset.length;\n        return this.dataset;\n    }\n\n    /**\n     * Return the size of the dataset.\n     *\n     * @returns {number}\n     */\n    getDatasetSize() {\n        return this.datasetSize;\n    }\n\n    /**\n     * Return the results of the filter upon the dataset.\n     *\n     * @returns {Array}\n     */\n    getMatchedResults() {\n        return this.matchedResults;\n    }\n\n    /**\n     * Given a filter has been run across the dataset, store the matched results.\n     *\n     * @param {Array} result\n     */\n    setMatchedResults(result) {\n        this.matchedResults = result;\n    }\n\n    /**\n     * Get the value that the user entered.\n     *\n     * @returns {string}\n     */\n    getSearchTerm() {\n        return this.searchTerm;\n    }\n\n    /**\n     * Get the transformed search value.\n     *\n     * @returns {string}\n     */\n    getPreppedSearchTerm() {\n        return this.preppedSearchTerm;\n    }\n\n    /**\n     * When a user searches for something, set our variable to manage it.\n     *\n     * @param {string} result\n     */\n    setSearchTerms(result) {\n        this.searchTerm = result;\n        this.preppedSearchTerm = result.toLowerCase();\n    }\n\n    /**\n     * Return an object containing a handfull of dom nodes that we sometimes need the value of.\n     *\n     * @returns {object}\n     */\n    getHTMLElements() {\n        this.updateNodes();\n        return {\n            searchDropdown: this.searchDropdown,\n            currentViewAll: this.currentViewAll,\n            searchInput: this.searchInput,\n            clearSearchButton: this.clearSearchButton,\n            trigger: this.component.querySelector(this.selectors.trigger),\n        };\n    }\n\n    /**\n     * When called, close the dropdown and reset the input field attributes.\n     *\n     * @param {Boolean} clear Conditionality clear the input box.\n     */\n    closeSearch(clear = false) {\n        this.toggleDropdown();\n        // Hide the \"clear\" search button search bar.\n        this.clearSearchButton.classList.add('d-none');\n        if (clear) {\n            // Clear the entered search query in the search bar and hide the search results container.\n            this.setSearchTerms('');\n            this.searchInput.value = \"\";\n        }\n    }\n\n    /**\n     * Check whether search results are currently visible.\n     *\n     * @returns {Boolean}\n     */\n    searchResultsVisible() {\n        const {searchDropdown} = this.getHTMLElements();\n        // If a Node is not visible, then the offsetParent is null.\n        return searchDropdown.offsetParent !== null;\n    }\n\n    /**\n     * When called, update the dropdown fields.\n     *\n     * @param {Boolean} on Flag to toggle hiding or showing values.\n     */\n    toggleDropdown(on = false) {\n        this.$component.dropdown('toggle');\n        if (on) {\n            this.searchDropdown.classList.add('show');\n            $(this.searchDropdown).show();\n        } else {\n            this.searchDropdown.classList.remove('show');\n            $(this.searchDropdown).hide();\n        }\n    }\n\n    /**\n     * These class members change when a new result set is rendered. So update for fresh data.\n     */\n    updateNodes() {\n        this.resultNodes = [...this.component.querySelectorAll(this.selectors.resultitems)];\n        this.currentNode = this.resultNodes.find(r => r.id === document.activeElement.id);\n        this.currentViewAll = this.component.querySelector(this.selectors.viewall);\n        this.clearSearchButton = this.component.querySelector(this.selectors.clearSearch);\n        this.searchInput = this.component.querySelector(this.selectors.input);\n        this.searchDropdown = this.component.querySelector(this.selectors.dropdown);\n    }\n\n    /**\n     * Register clickable event listeners.\n     */\n    registerClickHandlers() {\n        // Register click events within the component.\n        this.component.addEventListener('click', this.clickHandler.bind(this));\n    }\n\n    /**\n     * Register key event listeners.\n     */\n    registerKeyHandlers() {\n        CustomEvents.define(document, events);\n\n        // Register click events.\n        events.forEach((event) => {\n            this.component.addEventListener(event, this.keyHandler.bind(this));\n        });\n    }\n\n    /**\n     * Register input event listener for the text input area.\n     */\n    registerInputHandlers() {\n        // Register & handle the text input.\n        this.searchInput.addEventListener('input', debounce(async() => {\n            if (this.getSearchTerm() === this.searchInput.value && this.searchResultsVisible()) {\n                window.console.warn(`Search term matches input value - skipping`);\n                // The debounce canhappen multiple times quickly. GRrargh\n                return;\n            }\n            this.setSearchTerms(this.searchInput.value);\n            // We can also require a set amount of input before search.\n            if (this.getSearchTerm() === '') {\n                this.toggleDropdown();\n                // Hide the \"clear\" search button in the search bar.\n                this.clearSearchButton.classList.add('d-none');\n            } else {\n                const pendingPromise = new Pending();\n                await this.renderAndShow().then(() => {\n                    // Display the \"clear\" search button in the search bar.\n                    this.clearSearchButton.classList.remove('d-none');\n                    return;\n                }).then(() => {\n                    pendingPromise.resolve();\n                    return true;\n                });\n            }\n        }, 300, {pending: true}));\n    }\n\n    /**\n     * Update any changeable nodes, filter and then render the result.\n     *\n     * @returns {Promise<void>}\n     */\n    async filterrenderpipe() {\n        this.updateNodes();\n        this.setMatchedResults(await this.filterDataset(await this.getDataset()));\n        this.filterMatchDataset();\n        await this.renderDropdown();\n    }\n\n    /**\n     * A combo method to take the matching fields and render out the results.\n     *\n     * @returns {Promise<void>}\n     */\n    async renderAndShow() {\n        // User has given something for us to filter against.\n        this.setMatchedResults(await this.filterDataset(await this.getDataset()));\n        await this.filterMatchDataset();\n        // Replace the dropdown node contents and show the results.\n        await this.renderDropdown();\n        // Set the dropdown to open.\n        this.toggleDropdown(true);\n    }\n\n    /**\n     * Set the current focus either on the preceding or next result item.\n     *\n     * @param {Number} direction Is the user moving up or down the resultset?\n     * @param {KeyboardEvent} e The JS event from the event handler.\n     */\n    keyUpDown(direction, e) {\n        e.preventDefault();\n        // Stop Bootstrap from being clever.\n        e.stopPropagation();\n        // Current focus is on the input box so depending on direction, go to the top or the bottom of the displayed results.\n        if (document.activeElement === this.searchInput && this.resultNodes.length > 0) {\n            if (direction === UP) {\n                this.moveToLastNode();\n            } else {\n                this.moveToFirstNode();\n            }\n        }\n        const index = this.resultNodes.indexOf(this.currentNode);\n        if (this.currentNode) {\n            if (direction === UP) {\n                if (index === 0) {\n                    this.moveToLastNode();\n                } else {\n                    this.moveToNode(index - 1);\n                }\n            } else {\n                if (index + 1 >= this.resultNodes.length) {\n                    this.moveToFirstNode();\n                } else {\n                    this.moveToNode(index + 1);\n                }\n            }\n        } else {\n            if (direction === UP) {\n                this.moveToLastNode();\n            } else {\n                this.moveToFirstNode();\n            }\n        }\n    }\n\n    /**\n     * The handler for when a user interacts with the component.\n     *\n     * @param {MouseEvent} e The triggering event that we are working with.\n     */\n    async clickHandler(e) {\n        this.updateNodes();\n\n        // Prevent normal key presses activating this.\n        if (e.target.closest('.dropdown-item') && e.button === 0) {\n            window.location = e.target.closest('.dropdown-item').href;\n        }\n        // The \"clear search\" button is triggered.\n        if (e.target.closest(this.selectors.clearSearch) && e.button === 0) {\n            this.closeSearch(true);\n            this.searchInput.focus({preventScroll: true});\n        }\n        // User may have accidentally clicked off the dropdown and wants to reopen it.\n        if (e.target.closest(this.selectors.input) && this.getSearchTerm() !== '' && e.button === 0) {\n            await this.renderAndShow();\n        }\n    }\n\n    /**\n     * The handler for when a user presses a key within the component.\n     *\n     * @param {KeyboardEvent} e The triggering event that we are working with.\n     */\n    keyHandler(e) {\n        this.updateNodes();\n        // Switch the key presses to handle keyboard nav.\n        switch (e.key) {\n            case 'ArrowUp':\n                this.keyUpDown(UP, e);\n                break;\n            case 'ArrowDown':\n                this.keyUpDown(DOWN, e);\n                break;\n            case 'Home':\n                e.preventDefault();\n                this.moveToFirstNode();\n                break;\n            case 'End':\n                e.preventDefault();\n                this.moveToLastNode();\n                break;\n            case 'Tab':\n                // If the current focus is on the view all link, then close the widget then set focus on the next tertiary nav item.\n                if (e.target.closest(this.selectors.viewall)) {\n                    this.closeSearch();\n                }\n                break;\n        }\n    }\n\n    /**\n     * Set focus on a given node after parsed through the calling functions.\n     *\n     * @param {HTMLElement} node The node to set focus upon.\n     */\n    selectNode = (node) => {\n        node.focus({preventScroll: true});\n        this.searchDropdown.scrollTop = node.offsetTop - (node.clientHeight / 2);\n    };\n\n    /**\n     * Set the focus on the first node within the array.\n     */\n    moveToFirstNode = () => {\n        if (this.resultNodes.length > 0) {\n            this.selectNode(this.resultNodes[0]);\n        }\n    };\n\n    /**\n     * Set the focus to the final node within the array.\n     */\n    moveToLastNode = () => {\n        if (this.resultNodes.length > 0) {\n            this.selectNode(this.resultNodes[this.resultNodes.length - 1]);\n        }\n    };\n\n    /**\n     * Set focus on any given specified node within the node array.\n     *\n     * @param {Number} index Which item within the array to set focus upon.\n     */\n    moveToNode = (index) => {\n        if (this.resultNodes.length > 0) {\n            this.selectNode(this.resultNodes[index]);\n        }\n    };\n}\n"],"names":["_interopRequireDefault","obj","__esModule","default","_jquery","_custom_interaction_events","_pending","events","CustomEvents","activate","keyboardActivate","_exports","selectors","component","this","componentSelector","trigger","triggerSelector","input","clearSearch","dropdown","dropdownSelector","resultitems","viewall","matchedResults","searchTerm","preppedSearchTerm","resultNodes","currentNode","currentViewAll","dataset","datasetSize","document","querySelector","searchInput","searchDropdown","clearSearchButton","$component","$","constructor","_this$searchInput","setSearchTerms","value","registerClickHandlers","registerKeyHandlers","registerInputHandlers","fetchDataset","Error","name","filterDataset","filterMatchDataset","renderDropdown","getDataset","length","getDatasetSize","getMatchedResults","setMatchedResults","result","getSearchTerm","getPreppedSearchTerm","toLowerCase","getHTMLElements","updateNodes","closeSearch","clear","arguments","undefined","toggleDropdown","classList","add","searchResultsVisible","offsetParent","on","show","remove","hide","querySelectorAll","find","r","id","activeElement","addEventListener","clickHandler","bind","define","forEach","event","keyHandler","debounce","async","window","console","warn","pendingPromise","Pending","renderAndShow","then","resolve","pending","filterrenderpipe","keyUpDown","direction","e","preventDefault","stopPropagation","moveToLastNode","moveToFirstNode","index","indexOf","moveToNode","target","closest","button","location","href","focus","preventScroll","key","selectNode","node","scrollTop","offsetTop","clientHeight"],"mappings":"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"}