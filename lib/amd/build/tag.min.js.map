{"version":3,"file":"tag.min.js","sources":["../src/tag.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AJAX helper for the tag management page.\n *\n * @module     core/tag\n * @copyright  2015 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.0\n */\n\nimport $ from 'jquery';\nimport {call as fetchMany} from 'core/ajax';\nimport * as Notification from 'core/notification';\nimport * as Templates from 'core/templates';\nimport {\n    get_string as getString,\n    get_strings as getStrings,\n} from 'core/str';\nimport * as ModalEvents from 'core/modal_events';\nimport Pending from 'core/pending';\nimport SaveCancelModal from 'core/modal_save_cancel';\nimport Config from 'core/config';\n\nconst getTagIndex = (tagindex) => fetchMany([{\n    methodname: 'core_tag_get_tagindex',\n    args: {tagindex}\n}])[0];\n\nconst getCheckedTags = (form) => form.querySelectorAll('input[data-togglegroup=\"tags-manage\"][data-toggle=\"slave\"]:checked');\n\nconst handleCombineRequest = async(tagManagementCombine) => {\n    const pendingPromise = new Pending('core/tag:tag-management-combine');\n    const form = tagManagementCombine.closest('form');\n    const checkedTags = getCheckedTags(form);\n\n    if (checkedTags.length <= 1) {\n        // We need at least 2 tags to combine them.\n        Notification.alert(\n            getString('combineselected', 'tag'),\n            getString('selectmultipletags', 'tag'),\n            getString('ok'),\n        );\n\n        return;\n    }\n\n    const tags = Array.from(checkedTags.values()).map((tag) => {\n        const namedElement = document.querySelector(`.inplaceeditable[data-itemtype=tagname][data-itemid=\"${tag.value}\"]`);\n        return {\n            id: tag.value,\n            name: namedElement.dataset.value,\n        };\n    });\n\n    const modal = await SaveCancelModal.create({\n        title: getString('combineselected', 'tag'),\n        buttons: {\n            save: getString('continue', 'core'),\n        },\n        body: Templates.render('core_tag/combine_tags', {tags}),\n        show: true,\n        removeOnClose: true,\n    });\n\n    // Handle save event.\n    modal.getRoot().on(ModalEvents.save, (e) => {\n        e.preventDefault();\n\n        // Append this temp element in the form in the tags list, not the form in the modal. Confusing, right?!?\n        const tempElement = document.createElement('input');\n        tempElement.hidden = true;\n        tempElement.name = tagManagementCombine.name;\n        form.append(tempElement);\n\n        // Get the selected tag from the modal.\n        var maintag = $('input[name=maintag]:checked', '#combinetags_form').val();\n        // Append this in the tags list form.\n        $(\"<input type='hidden'/>\").attr('name', 'maintag').attr('value', maintag).appendTo(form);\n        // Submit the tags list form.\n        form.submit();\n    });\n\n    await modal.getBodyPromise();\n    // Tick the first option.\n    const firstOption = document.querySelector('#combinetags_form input[type=radio]');\n    firstOption.focus();\n    firstOption.checked = true;\n\n    pendingPromise.resolve();\n\n    return;\n};\n\nconst addStandardTags = async() => {\n    var pendingPromise = new Pending('core/tag:addstandardtag');\n\n    const modal = await SaveCancelModal.create({\n        title: getString('addotags', 'tag'),\n        body: Templates.render('core_tag/add_tags', {\n            actionurl: window.location.href,\n            sesskey: M.cfg.sesskey,\n        }),\n        buttons: {\n            save: getString('continue', 'core'),\n        },\n        removeOnClose: true,\n        show: true,\n    });\n\n    // Handle save event.\n    modal.getRoot().on(ModalEvents.save, (e) => {\n        var tagsInput = $(e.currentTarget).find('#id_tagslist');\n        var name = tagsInput.val().trim();\n\n        // Set the text field's value to the trimmed value.\n        tagsInput.val(name);\n\n        // Add submit event listener to the form.\n        var tagsForm = $('#addtags_form');\n        tagsForm.on('submit', function(e) {\n            // Validate the form.\n            var form = $('#addtags_form');\n            if (form[0].checkValidity() === false) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n            form.addClass('was-validated');\n\n            // BS2 compatibility.\n            $('[data-region=\"tagslistinput\"]').addClass('error');\n            var errorMessage = $('#id_tagslist_error_message');\n            errorMessage.removeAttr('hidden');\n            errorMessage.addClass('help-block');\n        });\n\n        // Try to submit the form.\n        tagsForm.submit();\n\n        return false;\n    });\n\n    await modal.getBodyPromise();\n    pendingPromise.resolve();\n};\n\nconst deleteSelectedTags = async(form) => {\n    const checkedTags = getCheckedTags(form);\n    if (!checkedTags.length) {\n        return;\n    }\n\n    try {\n        await Notification.saveCancelPromise(\n            getString('delete'),\n            getString('confirmdeletetags', 'tag'),\n            getString('yes'),\n            getString('no'),\n        );\n\n        // Append this temp element in the form in the tags list, not the form in the modal. Confusing, right?!?\n        const tempElement = document.createElement('input');\n        tempElement.hidden = true;\n        tempElement.name = 'bulkdelete';\n        form.append(tempElement);\n        form.submit();\n    } catch {\n        return;\n    }\n};\n\nconst deleteSelectedTag = async(button) => {\n    try {\n        await Notification.saveCancelPromise(\n            getString('delete'),\n            getString('confirmdeletetag', 'tag'),\n            getString('yes'),\n            getString('no'),\n        );\n\n        window.location.href = button.href;\n    } catch {\n        return;\n    }\n};\n\nconst deleteSelectedCollection = async(button) => {\n    try {\n        await Notification.saveCancelPromise(\n            getString('delete'),\n            getString('suredeletecoll', 'tag', button.dataset.collname),\n            getString('yes'),\n            getString('no'),\n        );\n\n        const redirectTarget = new URL(button.dataset.url);\n        redirectTarget.searchParams.set('sesskey', Config.sesskey);\n        window.location.href = redirectTarget;\n    } catch {\n        return;\n    }\n};\n\nconst addTagCollection = async(link) => {\n    const pendingPromise = new Pending('core/tag:initManageCollectionsPage-addtagcoll');\n    const href = link.dataset.url;\n\n    const modal = await SaveCancelModal.create({\n        title: getString('addtagcoll', 'tag'),\n        buttons: {\n            save: getString('create', 'core'),\n        },\n        body: Templates.render('core_tag/add_tag_collection', {\n            actionurl: href,\n            sesskey: M.cfg.sesskey,\n        }),\n        removeOnClose: true,\n        show: true,\n    });\n\n    // Handle save event.\n    modal.getRoot().on(ModalEvents.save, (e) => {\n        const collectionInput = $(e.currentTarget).find('#addtagcoll_name');\n        const name = collectionInput.val().trim();\n        // Set the text field's value to the trimmed value.\n        collectionInput.val(name);\n\n        // Add submit event listener to the form.\n        const form = $('#addtagcoll_form');\n        form.on('submit', function(e) {\n            // Validate the form.\n            if (form[0].checkValidity() === false) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n            form.addClass('was-validated');\n\n            // BS2 compatibility.\n            $('[data-region=\"addtagcoll_nameinput\"]').addClass('error');\n            const errorMessage = $('#id_addtagcoll_name_error_message');\n            errorMessage.removeAttr('hidden');\n            errorMessage.addClass('help-block');\n        });\n\n        // Try to submit the form.\n        form.submit();\n\n        return false;\n    });\n\n    pendingPromise.resolve();\n};\n\n/**\n * Initialises tag index page.\n *\n * @method initTagindexPage\n */\nexport const initTagindexPage = async() => {\n    document.addEventListener('click', async(e) => {\n        const targetArea = e.target.closest('a[data-quickload=\"1\"]');\n        if (!targetArea) {\n            return;\n        }\n        const tagArea = targetArea.closest('.tagarea[data-ta]');\n        if (!tagArea) {\n            return;\n        }\n\n        e.preventDefault();\n        const pendingPromise = new Pending('core/tag:initTagindexPage');\n\n        const query = targetArea.search.replace(/^\\?/, '');\n        const params = Object.fromEntries((new URLSearchParams(query)).entries());\n\n        try {\n            const data = await getTagIndex(params);\n            const {html, js} = await Templates.renderForPromise('core_tag/index', data);\n            Templates.replaceNode(tagArea, html, js);\n        } catch (error) {\n            Notification.exception(error);\n        }\n        pendingPromise.resolve();\n    });\n};\n\n/**\n * Initialises tag management page.\n *\n * @method initManagePage\n */\nexport const initManagePage = () => {\n    // Set cell 'time modified' to 'now' when any of the element is updated in this row.\n    $('body').on('updated', '[data-inplaceeditable]', function(e) {\n        var pendingPromise = new Pending('core/tag:initManagePage');\n\n        getStrings([\n            {\n                key: 'selecttag',\n                component: 'core_tag',\n            },\n            {\n                key: 'now',\n                component: 'core',\n            },\n        ])\n        .then(function(result) {\n            $('label[for=\"tagselect' + e.ajaxreturn.itemid + '\"]').html(result[0]);\n            $(e.target).closest('tr').find('td.col-timemodified').html(result[1]);\n\n            return;\n        })\n        .always(pendingPromise.resolve)\n        .catch(Notification.exception);\n\n        if (e.ajaxreturn.itemtype === 'tagflag') {\n            var row = $(e.target).closest('tr');\n            if (e.ajaxreturn.value === '0') {\n                row.removeClass('table-warning');\n            } else {\n                row.addClass('table-warning');\n            }\n        }\n    });\n\n    // Confirmation for bulk tag combine button.\n    document.addEventListener('click', async(e) => {\n        const tagManagementCombine = e.target.closest('#tag-management-combine');\n        if (tagManagementCombine) {\n            e.preventDefault();\n            handleCombineRequest(tagManagementCombine);\n        }\n\n        if (e.target.closest('a[data-action=\"addstandardtag\"]')) {\n            e.preventDefault();\n            addStandardTags();\n        }\n\n        const bulkActionDeleteButton = e.target.closest('#tag-management-delete');\n        if (bulkActionDeleteButton) {\n            e.preventDefault();\n            deleteSelectedTags(bulkActionDeleteButton.closest('form'));\n        }\n\n        const rowDeleteButton = e.target.closest('.tagdelete');\n        if (rowDeleteButton) {\n            e.preventDefault();\n            deleteSelectedTag(rowDeleteButton);\n        }\n    });\n\n    // When user changes tag name to some name that already exists suggest to combine the tags.\n    $('body').on('updatefailed', '[data-inplaceeditable][data-itemtype=tagname]', async(e) => {\n        var exception = e.exception; // The exception object returned by the callback.\n        var newvalue = e.newvalue; // The value that user tried to udpated the element to.\n        var tagid = $(e.target).attr('data-itemid');\n        if (exception.errorcode !== 'namesalreadybeeingused') {\n            return;\n        }\n        e.preventDefault(); // This will prevent default error dialogue.\n\n        try {\n            await Notification.saveCancelPromise(\n                getString('confirm'),\n                getString('nameuseddocombine', 'tag'),\n                getString('yes'),\n                getString('cancel'),\n            );\n\n            // The Promise will resolve on 'Yes' button, and reject on 'Cancel' button.\n            const redirectTarget = new URL(window.location);\n            redirectTarget.searchParams.set('newname', newvalue);\n            redirectTarget.searchParams.set('tagid', tagid);\n            redirectTarget.searchParams.set('action', 'renamecombine');\n            redirectTarget.searchParams.set('sesskey', Config.sesskey);\n\n            window.location.href = redirectTarget;\n        } catch {\n            return;\n        }\n    });\n};\n\n/**\n * Initialises tag collection management page.\n *\n * @method initManageCollectionsPage\n */\nexport const initManageCollectionsPage = () => {\n    $('body').on('updated', '[data-inplaceeditable]', function(e) {\n        var pendingPromise = new Pending('core/tag:initManageCollectionsPage-updated');\n\n        var ajaxreturn = e.ajaxreturn,\n            areaid, collid, isenabled;\n        if (ajaxreturn.component === 'core_tag' && ajaxreturn.itemtype === 'tagareaenable') {\n            areaid = $(this).attr('data-itemid');\n            $(\".tag-collections-table ul[data-collectionid] li[data-areaid=\" + areaid + \"]\").hide();\n            isenabled = ajaxreturn.value;\n            if (isenabled === '1') {\n                $(this).closest('tr').removeClass('dimmed_text');\n                collid = $(this).closest('tr').find('[data-itemtype=\"tagareacollection\"]').attr(\"data-value\");\n                $(\".tag-collections-table ul[data-collectionid=\" + collid + \"] li[data-areaid=\" + areaid + \"]\").show();\n            } else {\n                $(this).closest('tr').addClass('dimmed_text');\n            }\n        }\n        if (ajaxreturn.component === 'core_tag' && ajaxreturn.itemtype === 'tagareacollection') {\n            areaid = $(this).attr('data-itemid');\n            $(\".tag-collections-table ul[data-collectionid] li[data-areaid=\" + areaid + \"]\").hide();\n            collid = $(this).attr('data-value');\n            isenabled = $(this).closest('tr').find('[data-itemtype=\"tagareaenable\"]').attr(\"data-value\");\n            if (isenabled === \"1\") {\n                $(\".tag-collections-table ul[data-collectionid=\" + collid + \"] li[data-areaid=\" + areaid + \"]\").show();\n            }\n        }\n\n        pendingPromise.resolve();\n    });\n\n    document.addEventListener('click', async(e) => {\n        const addTagCollectionNode = e.target.closest('.addtagcoll > a');\n        if (addTagCollectionNode) {\n            e.preventDefault();\n            addTagCollection(addTagCollectionNode);\n            return;\n        }\n\n        const deleteCollectionButton = e.target.closest('.tag-collections-table .action_delete');\n        if (deleteCollectionButton) {\n            e.preventDefault();\n            deleteSelectedCollection(deleteCollectionButton);\n        }\n    });\n};\n"],"names":["_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireWildcard","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","_interopRequireDefault","obj","_jquery","Notification","Templates","ModalEvents","_pending","_modal_save_cancel","_config","getCheckedTags","form","querySelectorAll","_exports","initTagindexPage","async","document","addEventListener","targetArea","target","closest","tagArea","preventDefault","pendingPromise","Pending","query","search","replace","params","fromEntries","URLSearchParams","entries","data","tagindex","fetchMany","methodname","args","html","js","renderForPromise","replaceNode","error","exception","resolve","initManagePage","$","on","getStrings","key","component","then","result","ajaxreturn","itemid","find","always","catch","itemtype","row","value","removeClass","addClass","tagManagementCombine","checkedTags","length","alert","getString","get_string","tags","Array","from","values","map","tag","namedElement","querySelector","id","name","dataset","modal","SaveCancelModal","create","title","buttons","save","body","render","show","removeOnClose","getRoot","tempElement","createElement","hidden","append","maintag","val","attr","appendTo","submit","getBodyPromise","firstOption","focus","checked","handleCombineRequest","actionurl","window","location","href","sesskey","M","cfg","tagsInput","currentTarget","trim","tagsForm","checkValidity","stopPropagation","errorMessage","removeAttr","addStandardTags","bulkActionDeleteButton","saveCancelPromise","deleteSelectedTags","rowDeleteButton","button","deleteSelectedTag","newvalue","tagid","errorcode","redirectTarget","URL","searchParams","Config","initManageCollectionsPage","areaid","collid","this","hide","addTagCollectionNode","link","url","collectionInput","addTagCollection","deleteCollectionButton","collname","deleteSelectedCollection"],"mappings":"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"}