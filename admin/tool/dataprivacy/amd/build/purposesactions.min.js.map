{"version":3,"file":"purposesactions.min.js","sources":["../src/purposesactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for purposes actions.\n *\n * @module     tool_dataprivacy/purposesactions\n * @copyright  2018 David Monllao\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module for purpose actions.\n *\n * @module     tool_dataprivacy/purposeactions\n * @copyright  2018 David Monllao\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport * as Ajax from 'core/ajax';\nimport * as Notification from 'core/notification';\nimport * as Str from 'core/str';\nimport ModalEvents from 'core/modal_events';\nimport ModalSaveCancel from 'core/modal_save_cancel';\n\n/**\n * List of action selectors.\n *\n * @type {{DELETE: string}}\n */\nconst ACTIONS = {\n    DELETE: '[data-action=\"deletepurpose\"]',\n};\n\nexport default class PurposeActions {\n\n    static init() {\n        return new this();\n    }\n\n    constructor() {\n        this.registerEvents();\n    }\n\n    deletePurpose(id) {\n        return Ajax.call([{\n            methodname: 'tool_dataprivacy_delete_purpose',\n            args: {id}\n        }])[0];\n    }\n\n    handleRemoval(id) {\n        this.deletePurpose(id)\n            .then((data) => {\n                if (data.result) {\n                    document.querySelector(`tr[data-purposeid=\"${id}\"]`)?.remove();\n                } else {\n                    Notification.addNotification({\n                        message: data.warnings[0].message,\n                        type: 'error'\n                    });\n                }\n\n                return;\n            })\n            .catch(Notification.exception);\n\n    }\n\n    /**\n     * Register event listeners.\n     */\n    registerEvents() {\n        document.addEventListener('click', (e) => {\n            const target = e.target.closest(ACTIONS.DELETE);\n            if (!target) {\n                return;\n            }\n\n            e.preventDefault();\n\n            this.confirmRemoval(target);\n        });\n    }\n\n    confirmRemoval(target) {\n        const id = target.dataset.id;\n        var purposename = target.dataset.name;\n        var stringkeys = [\n            {\n                key: 'deletepurpose',\n                component: 'tool_dataprivacy'\n            },\n            {\n                key: 'deletepurposetext',\n                component: 'tool_dataprivacy',\n                param: purposename\n            },\n            {\n                key: 'delete'\n            }\n        ];\n\n        Str.get_strings(stringkeys).then(([\n            title,\n            body,\n            save,\n        ]) => ModalSaveCancel.create({\n            title,\n            body,\n            buttons: {\n                save,\n            },\n            show: true,\n            removeOnClose: true,\n        }))\n            .then((modal) => {\n                // Handle save event.\n                modal.getRoot().on(ModalEvents.save, () => this.handleRemoval(id));\n\n                return modal;\n            })\n            .catch(Notification.exception);\n    }\n}\n"],"names":["_interopRequireDefault","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireWildcard","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","Ajax","Notification","Str","_modal_events","_modal_save_cancel","ACTIONS","_exports","init","this","constructor","registerEvents","deletePurpose","id","methodname","args","handleRemoval","then","data","_document$querySelect","result","document","querySelector","remove","addNotification","message","warnings","type","catch","exception","addEventListener","target","closest","preventDefault","confirmRemoval","dataset","stringkeys","key","component","param","name","get_strings","_ref","title","body","save","ModalSaveCancel","create","buttons","show","removeOnClose","modal","getRoot","on","ModalEvents"],"mappings":"yNAgDqD,SAAAA,uBAAAC,KAAAA,OAAAA,KAAAA,IAAAC,WAAAD,IAAAE,CAAAA,QAAAF,IAAA,CAAA,SAAAG,yBAAAC,GAAA,GAAA,mBAAAC,QAAA,OAAA,KAAA,IAAAC,EAAAD,IAAAA,QAAAE,EAAAF,IAAAA,eAAAF,yBAAA,SAAAC,GAAAA,OAAAA,EAAAG,EAAAD,IAAAF,EAAA,CAAA,SAAAI,wBAAAJ,EAAAE,GAAAA,IAAAA,GAAAF,GAAAA,EAAAH,kBAAAG,EAAA,GAAA,OAAAA,GAAA,iBAAAA,GAAA,mBAAAA,EAAA,MAAA,CAAAF,QAAAE,GAAA,IAAAG,EAAAJ,yBAAAG,GAAAC,GAAAA,GAAAA,EAAAE,IAAAL,GAAAG,OAAAA,EAAAG,IAAAN,GAAAO,IAAAA,GAAAC,UAAA,MAAAC,EAAAC,OAAAC,gBAAAD,OAAAE,yBAAA,IAAA,IAAAC,KAAAb,EAAA,GAAA,YAAAa,GAAAH,OAAAI,UAAAC,eAAAC,KAAAhB,EAAAa,GAAAI,CAAAA,IAAAA,EAAAR,EAAAC,OAAAE,yBAAAZ,EAAAa,GAAA,KAAAI,IAAAA,EAAAX,KAAAW,EAAAC,KAAAR,OAAAC,eAAAJ,EAAAM,EAAAI,GAAAV,EAAAM,GAAAb,EAAAa,EAAA,CAAA,OAAAN,EAAAT,QAAAE,EAAAG,GAAAA,EAAAe,IAAAlB,EAAAO,GAAAA;;;;;;;;;;;;;;KAAA,iFAJrDY,KAAAf,wBAAAe,MACAC,aAAAhB,wBAAAgB,cACAC,IAAAjB,wBAAAiB,KACAC,cAAA3B,uBAAA2B,eACAC,mBAAA5B,uBAAA4B,oBAOA,MAAMC,eACM,gCA6FX,OAAAC,SAAA3B,QA1Fc,MAEX,WAAO4B,GACH,OAAO,IAAIC,IACf,CAEAC,WAAAA,GACID,KAAKE,gBACT,CAEAC,aAAAA,CAAcC,IACV,OAAOZ,KAAKH,KAAK,CAAC,CACdgB,WAAY,kCACZC,KAAM,CAACF,UACP,EACR,CAEAG,aAAAA,CAAcH,IACVJ,KAAKG,cAAcC,IACdI,MAAMC,OACc,IAAAC,sBAAbD,KAAKE,eACLD,sBAAAE,SAASC,cAAe,sBAAqBT,eAAO,IAAAM,uBAApDA,sBAAsDI,SAEtDrB,aAAasB,gBAAgB,CACzBC,QAASP,KAAKQ,SAAS,GAAGD,QAC1BE,KAAM,SAId,IAEHC,MAAM1B,aAAa2B,UAE5B,CAKAlB,cAAAA,GACIU,SAASS,iBAAiB,SAAUhD,IAChC,MAAMiD,OAASjD,EAAEiD,OAAOC,QAAQ1B,gBAC3ByB,SAILjD,EAAEmD,iBAEFxB,KAAKyB,eAAeH,QAAO,GAEnC,CAEAG,cAAAA,CAAeH,QACX,MAAMlB,GAAKkB,OAAOI,QAAQtB,GAC1B,IACIuB,WAAa,CACb,CACIC,IAAK,gBACLC,UAAW,oBAEf,CACID,IAAK,oBACLC,UAAW,mBACXC,MATUR,OAAOI,QAAQK,MAW7B,CACIH,IAAK,WAIblC,IAAIsC,YAAYL,YAAYnB,MAAKyB,OAAA,IAC7BC,MACAC,KACAC,MACHH,KAAA,OAAKI,mBAAAA,QAAgBC,OAAO,CACzBJ,YACAC,UACAI,QAAS,CACLH,WAEJI,MAAM,EACNC,eAAe,GACjB,IACGjC,MAAMkC,QAEHA,MAAMC,UAAUC,GAAGC,cAAW1E,QAACiE,MAAM,IAAMpC,KAAKO,cAAcH,MAEvDsC,SAEVvB,MAAM1B,aAAa2B,UAC5B,GACHtB,SAAA3B,OAAA"}