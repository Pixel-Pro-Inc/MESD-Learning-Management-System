{"version":3,"file":"uninstall.min.js","sources":["../src/uninstall.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport {getStrings} from 'core/str';\nimport {saveCancelPromise, alert as displayAlert} from \"core/notification\";\nimport MoodleConfig from 'core/config';\n\nexport const init = (form) => {\n    form?.addEventListener('submit', async(e) => {\n        e.preventDefault();\n        const selectedOptions = form.querySelector('#menuuninstalllang')?.selectedOptions;\n        if (!selectedOptions?.length) {\n            const alertStrings = await getStrings(\n                ['noenglishuninstalltitle', 'selectlangs'].map((key) => ({key, component: 'tool_langimport'})\n            ));\n            displayAlert(...alertStrings);\n            return;\n        }\n\n        if ([...selectedOptions].map((node) => node.value).indexOf('en') !== -1) {\n            const alertStrings = await getStrings(\n                ['noenglishuninstalltitle', 'noenglishuninstall'].map((key) => ({key, component: 'tool_langimport'})\n                ));\n            displayAlert(...alertStrings);\n            return;\n        }\n\n        const confirmationStrings = await getStrings([\n            {\n                key: 'uninstall',\n                component: 'tool_langimport',\n            },\n            {\n                key: 'uninstallconfirm',\n                component: 'tool_langimport',\n                param: [...selectedOptions].map((node) => node.textContent).join(', '),\n            },\n            {\n                key: 'yes',\n                component: 'core',\n            },\n        ]);\n\n        saveCancelPromise(...confirmationStrings).then(() => {\n            const url = new URL(form.action);\n            url.searchParams.append('sesskey', MoodleConfig.sesskey);\n            url.searchParams.append('confirmtouninstall', [...selectedOptions].map((node) => node.value).join('/'));\n            form.action = url.toString();\n            form.submit();\n            return true;\n        })\n        .catch(() => {\n            return false;\n        });\n    });\n};\n"],"names":["obj","_config","__esModule","default","_exports","init","form","addEventListener","async","_form$querySelector","e","preventDefault","selectedOptions","querySelector","length","alertStrings","getStrings","map","key","component","displayAlert","alert","node","value","indexOf","confirmationStrings","param","textContent","join","saveCancelPromise","then","url","URL","action","searchParams","append","MoodleConfig","sesskey","toString","submit","catch"],"mappings":"2IAiBuC,IAAAA,iFAAvCC,SAAuCD,IAAvCC,UAAuCD,IAAAE,WAAAF,IAAAG,CAAAA,QAAAH,KAkDrCI,SAAAC,KAhDmBC,OACjBA,YAAAA,KAAMC,iBAAiB,UAAUC,UAAY,IAAAC,oBACzCC,EAAEC,iBACF,MAAMC,gBAA0DH,QAA3CA,oBAAGH,KAAKO,cAAc,6BAAnBJ,IAAwCA,yBAAxCA,EAAAA,oBAA0CG,gBAClE,GAAKA,wBAAAA,gBAAiBE,OAAQ,CAC1B,MAAMC,mBAAqB,EAAAC,iBACvB,CAAC,0BAA2B,eAAeC,KAAKC,MAAS,CAACA,QAAKC,UAAW,uBAG9E,YADA,EAAAC,cAAYC,UAAIN,aAEpB,CAEA,IAAsE,IAAlE,IAAIH,iBAAiBK,KAAKK,MAASA,KAAKC,QAAOC,QAAQ,MAAc,CACrE,MAAMT,mBAAqB,EAAAC,iBACvB,CAAC,0BAA2B,sBAAsBC,KAAKC,MAAS,CAACA,QAAKC,UAAW,uBAGrF,YADA,EAAAC,cAAYC,UAAIN,aAEpB,CAEA,MAAMU,0BAA4B,EAAAT,KAAAA,YAAW,CACzC,CACIE,IAAK,YACLC,UAAW,mBAEf,CACID,IAAK,mBACLC,UAAW,kBACXO,MAAO,IAAId,iBAAiBK,KAAKK,MAASA,KAAKK,cAAaC,KAAK,OAErE,CACIV,IAAK,MACLC,UAAW,WAInB,EAAAU,cAAAA,sBAAqBJ,qBAAqBK,MAAK,KAC3C,MAAMC,IAAM,IAAIC,IAAI1B,KAAK2B,QAKzB,OAJAF,IAAIG,aAAaC,OAAO,UAAWC,QAAAA,QAAaC,SAChDN,IAAIG,aAAaC,OAAO,qBAAsB,IAAIvB,iBAAiBK,KAAKK,MAASA,KAAKC,QAAOK,KAAK,MAClGtB,KAAK2B,OAASF,IAAIO,WAClBhC,KAAKiC,UACE,CAAI,IAEdC,OAAM,KACI,GACT,GACJ,CACJ"}